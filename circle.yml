machine:
  xcode:
    version: "7.2"
test:
  override:
    - carthage update --platform iOS --no-use-binaries --use-submodules

    # WhirlyGlobe submodule setup and build
    - git submodule add git@github.com:mousebird/WhirlyGlobe.git Submodules
    - git submodule update --init --recursive
    - cd Submodules
    - git checkout tags/v2.4
    - cd ../..

    - set -o pipefail && xcodebuild -destination 'platform=iOS Simulator,name=iPhone 6,OS=latest'
      -sdk iphonesimulator -scheme "MaplyAdapter" clean test |
      tee $CIRCLE_ARTIFACTS/xcodebuild.log |
      xcpretty --report html --output $CIRCLE_TEST_REPORTS/results.html --report junit --output $CIRCLE_TEST_REPORTS/results.xml
  post:
    - bundle exec slather

